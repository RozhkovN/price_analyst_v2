# –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –ß—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ

–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è PostgreSQL —Å 4 –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏:

1. **backup-db.sh** - –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–µ–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
2. **restore-db.sh** - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±–µ–∫–∞–ø–∞
3. **cleanup-backups.sh** - —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±–µ–∫–∞–ø–æ–≤
4. **install-cron.sh** - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–µ—Ä–≤—ã–π —Ä—É—á–Ω–æ–π –±–µ–∫–∞–ø

```bash
chmod +x backup-db.sh restore-db.sh cleanup-backups.sh install-cron.sh
./backup-db.sh
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±–µ–∫–∞–ø–æ–≤

```bash
bash install-cron.sh
```

–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ 3 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:
- **1** - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–µ–∫–∞–ø –≤ 02:00 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- **2** - –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)
- **3** - –ö–∞–∂–¥—ã–π —á–∞—Å (–¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º)

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
crontab -l | grep backup
```

## üìã –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤

### backup-db.sh

–°–æ–∑–¥–∞–µ—Ç –ø–æ–ª–Ω—ã–π –¥–∞–º–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ —Å–∂–∞—Ç–æ–º –≤–∏–¥–µ.

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∞–º–ø –ë–î (gzip)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å –º–µ—Ç–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏ (YYYYMMDD_HHMMSS)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç –±–µ–∫–∞–ø—ã —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–∑ .env

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```bash
# –ü—Ä–æ—Å—Ç–æ–π –±–µ–∫–∞–ø
./backup-db.sh

# –í—ã–≤–æ–¥:
# üîÑ –ù–∞—á–∏–Ω–∞—é –±–µ–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...
# ‚è∞ –í—Ä–µ–º—è: 2024-12-23 14:30:45
# üìä –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö price_service...
# ‚úÖ –ë–µ–∫–∞–ø —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!
# üì¶ –§–∞–π–ª: ./backups/db_backup_20241223_143045.sql.gz
# üìè –†–∞–∑–º–µ—Ä: 12M
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ë–î –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω
- –§–∞–π–ª .env –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ë–î

### restore-db.sh

–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –±–µ–∫–∞–ø–∞.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```bash
# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫)
./restore-db.sh

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
./restore-db.sh backups/db_backup_20241223_143045.sql.gz

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ N-–≥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–µ–∫–∞–ø–∞
./restore-db.sh 1  # –ø–æ—Å–ª–µ–¥–Ω–∏–π
./restore-db.sh 2  # –ø—Ä–µ–¥–ø–æ—Å–ª–µ–¥–Ω–∏–π
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–µ–∫–∞–ø–æ–≤
2. –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
3. –û—Ç–∫–ª—é—á–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î
4. –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—É—é –ë–î
5. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏–∑ –±–µ–∫–∞–ø–∞
6. –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç —Ç–µ–∫—É—â—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!

### cleanup-backups.sh

–£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –±–µ–∫–∞–ø—ã —á—Ç–æ–±—ã —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –º–µ—Å—Ç–æ.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```bash
# –£–¥–∞–ª–∏—Ç—å –±–µ–∫–∞–ø—ã —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
./cleanup-backups.sh

# –£–¥–∞–ª–∏—Ç—å –±–µ–∫–∞–ø—ã —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
./cleanup-backups.sh 7

# –£–¥–∞–ª–∏—Ç—å –±–µ–∫–∞–ø—ã —Å—Ç–∞—Ä—à–µ 3 –¥–Ω–µ–π
./cleanup-backups.sh 3
```

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –±–µ–∫–∞–ø–æ–≤
- –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
- –û—Å—Ç–∞–≤—à–∏–µ—Å—è –±–µ–∫–∞–ø—ã
- –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

### install-cron.sh

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ cron –∑–∞–¥–∞—á.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```bash
bash install-cron.sh
```

**–í–∞—Ä–∏–∞–Ω—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**

| –í–∞—Ä–∏–∞–Ω—Ç | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ | –ò—Å—Ç–æ—Ä–∏—è | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|---------|-----------|---------|--------------|
| 1 | –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 02:00 | 30 –¥–Ω–µ–π | ‚úÖ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ |
| 2 | –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ | 7 –¥–Ω–µ–π | ‚úÖ Production |
| 3 | –ö–∞–∂–¥—ã–π —á–∞—Å | 3 –¥–Ω—è | ‚úÖ High-load |

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
/project
‚îú‚îÄ‚îÄ backup-db.sh           ‚Üê —Å–æ–∑–¥–∞–Ω–∏–µ –±–µ–∫–∞–ø–∞
‚îú‚îÄ‚îÄ restore-db.sh          ‚Üê –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ cleanup-backups.sh     ‚Üê —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö
‚îú‚îÄ‚îÄ install-cron.sh        ‚Üê —É—Å—Ç–∞–Ω–æ–≤–∫–∞ cron
‚îú‚îÄ‚îÄ CRON_SETUP.txt         ‚Üê –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è cron
‚îú‚îÄ‚îÄ BACKUP_SETUP.md        ‚Üê —ç—Ç–æ—Ç —Ñ–∞–π–ª
‚îî‚îÄ‚îÄ backups/               ‚Üê —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –±–µ–∫–∞–ø–æ–≤
    ‚îú‚îÄ‚îÄ db_backup_20241223_143045.sql.gz
    ‚îú‚îÄ‚îÄ db_backup_20241222_143045.sql.gz
    ‚îú‚îÄ‚îÄ backup.log         ‚Üê –ª–æ–≥–∏ –±–µ–∫–∞–ø–æ–≤
    ‚îî‚îÄ‚îÄ cleanup.log        ‚Üê –ª–æ–≥–∏ –æ—á–∏—Å—Ç–∫–∏
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Cron

### –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `install-cron.sh` –±—É–¥—É—Ç –¥–≤–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏:

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–¥–∞—á
crontab -l

# –í—ã–≤–æ–¥ (–ø—Ä–∏–º–µ—Ä):
# 0 2 * * * /Users/admin/.../backup-db.sh >> .../backups/backup.log 2>&1
# 0 3 * * * /Users/admin/.../cleanup-backups.sh 30 >> .../backups/cleanup.log 2>&1
```

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á

```bash
# –û—Ç–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä crontab
crontab -e

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏
crontab -r

# –£–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ backup –∑–∞–¥–∞—á–∏
crontab -l | grep -v backup-db.sh | grep -v cleanup-backups.sh | crontab -
```

### –§–æ—Ä–º–∞—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

```
MINUTE HOUR DAY MONTH DAYOFWEEK COMMAND
  0-59  0-23 1-31 1-12   0-6
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- `0 2 * * *` - –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 02:00
- `0 */6 * * *` - –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
- `0 * * * *` - –∫–∞–∂–¥—ã–π —á–∞—Å
- `0 14 * * 1-5` - –±—É–¥–Ω–∏ –≤ 14:00
- `0 0 1 * *` - –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∫–∞–ø–æ–≤

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –õ–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –±–µ–∫–∞–ø–æ–≤
tail -f backups/backup.log

# –õ–æ–≥–∏ –æ—á–∏—Å—Ç–∫–∏
tail -f backups/cleanup.log

# –í—Å–µ –ª–æ–≥–∏ —Å—Ä–∞–∑—É
tail -f backups/*.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```bash
# –†–∞–∑–º–µ—Ä –≤—Å–µ—Ö –±–µ–∫–∞–ø–æ–≤
du -sh backups/

# –°–ø–∏—Å–æ–∫ –±–µ–∫–∞–ø–æ–≤ —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏
ls -lh backups/db_backup_*.sql.gz

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–µ–∫–∞–ø–æ–≤
ls -1 backups/db_backup_*.sql.gz | wc -l
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–µ–∫–∞–ø–∞

```bash
# –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
ls -lt backups/db_backup_*.sql.gz | head -1

# –†–∞–∑–º–µ—Ä
du -h backups/db_backup_*.sql.gz | head -1
```

## üö® –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±–µ–∫–∞–ø–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û—à–∏–±–∫–∞ —Å–ª—É—á–∞–π–Ω–æ —É–¥–∞–ª–∏–ª–∞ –¥–∞–Ω–Ω—ã–µ

```bash
# 1. –ù–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π –±–µ–∫–∞–ø
./restore-db.sh

# 2. –í—ã–±—Ä–∞—Ç—å –Ω–æ–º–µ—Ä –±–µ–∫–∞–ø–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1 –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ)

# 3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (–≤–≤–µ–¥–∏—Ç–µ "–¥–∞")

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker compose restart app
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

```bash
./restore-db.sh backups/db_backup_20241220_143045.sql.gz
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä

```bash
# –ù–∞ —Å—Ç–∞—Ä–æ–º —Å–µ—Ä–≤–µ—Ä–µ
./backup-db.sh

# –ù–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
# 1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –±–µ–∫–∞–ø–∞
# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose up -d
# 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ –±–µ–∫–∞–ø–∞
./restore-db.sh backups/db_backup_YYYYMMDD_HHMMSS.sql.gz
```

## üíæ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

### –ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –±–µ–∫–∞–ø–æ–≤

| –†–∞–∑–º–µ—Ä –ë–î | –†–∞–∑–º–µ—Ä –±–µ–∫–∞–ø–∞ |
|-----------|--------------|
| 100 MB | 5-10 MB (—Å–∂–∞—Ç—ã–π) |
| 1 GB | 50-100 MB (—Å–∂–∞—Ç—ã–π) |
| 10 GB | 500 MB - 1 GB (—Å–∂–∞—Ç—ã–π) |

### –†–∞—Å—á–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –º–µ—Å—Ç–∞

```
–î–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –±–µ–∫–∞–ø–æ–≤ –Ω–∞ 30 –¥–Ω–µ–π:
–ú–µ—Å—Ç–æ = –†–∞–∑–º–µ—Ä_–±–µ–∫–∞–ø–∞ √ó 30

–ü—Ä–∏–º–µ—Ä: 50 MB √ó 30 = 1.5 GB
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- üìÅ –•—Ä–∞–Ω–∏—Ç–µ –±–µ–∫–∞–ø—ã –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º –¥–∏—Å–∫–µ/—Å–µ—Ä–≤–µ—Ä–µ
- üîí –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- üóùÔ∏è –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ backups
- üì§ –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –±–µ–∫–∞–ø—ã –Ω–∞ –æ–±–ª–∞–∫–æ (S3, Google Drive –∏ —Ç.–¥.)
- üîÑ –†–µ–≥—É–ª—è—Ä–Ω–æ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- üìù –í–µ–¥–∏—Ç–µ –ª–æ–≥–∏ –æ–ø–µ—Ä–∞—Ü–∏–π

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞

```bash
# –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å
chmod 700 backups/

# –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –±–µ–∫–∞–ø—ã
chmod 600 backups/db_backup_*.sql.gz
```

### –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ S3

```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ crontab
0 3 * * * aws s3 sync /path/to/backups s3://my-bucket/backups/ --delete
```

## üêõ –ü–æ–∏—Å–∫ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω"

```bash
# –†–µ—à–µ–Ω–∏–µ: –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker compose ps
```

### –ü—Ä–æ–±–ª–µ–º–∞: "—Ñ–∞–π–ª –±–µ–∫–∞–ø–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω"

```bash
# –†–µ—à–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª—ã
ls -la backups/

# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
mkdir -p backups
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Permission denied"

```bash
# –†–µ—à–µ–Ω–∏–µ: –¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
chmod +x backup-db.sh restore-db.sh cleanup-backups.sh install-cron.sh
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Cron –∑–∞–¥–∞—á–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–¥–∞—á–∏
crontab -l

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏
log show --predicate 'process == "cron"' --last 1h  # macOS

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–µ–∫–∞–ø–∞
tail -f backups/backup.log
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞"

```bash
# –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –±–µ–∫–∞–ø—ã
./cleanup-backups.sh 7

# –ò–ª–∏ –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ
./cleanup-backups.sh 1
```

## üìû –°–ø—Ä–∞–≤–∫–∞

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã PostgreSQL

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ë–î
docker exec price-service-db psql -U price_db_user -l

# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã
docker exec price-service-db psql -U price_db_user -d price_service -c "\dt"

# –ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑–º–µ—Ä –ë–î
docker exec price-service-db psql -U price_db_user -c "SELECT pg_database.datname, pg_size_pretty(pg_database_size(pg_database.datname)) FROM pg_database ORDER BY pg_database_size(pg_database.datname) DESC;"
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [Docker Official Documentation](https://docs.docker.com/)
- [Cron Documentation](https://linux.die.net/man/5/crontab)
